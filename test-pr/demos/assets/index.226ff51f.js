import{eZ as x,eP as B,et as I,e_ as N,eI as f,eS as C,eu as b,ev as k,eC as w,ew as i,ex as L,ey as $,eX as g,eJ as u,eA as p,ez as n,eB as l,eM as T,eD as v,eL as D,e$ as R,eN as O,eT as A}from"./main.4c7c23d9.js";import{l as z}from"./linkify-html.module.38598c19.js";class F{id;template;componentId;constructor(t){const s={...typeof t=="string"?{id:t,template:""}:t};({template:this.template,id:this.id}=s)}}class S{payload=[];templates={};defaultTemplates={}}const M={},U={setPayload(e,t){e.commit("SET_PAYLOAD",t)}},H={SET_PAYLOAD(e,t){e.payload=t}};var y=(e=>(e.payload="details/payload",e.templates="details/templates",e.defaultTemplates="details/defaultTemplates",e))(y||{});function V(){const e=new S;return{namespaced:!0,state:e,getters:{...M},actions:{...U},mutations:{...H,...x.mutations(e)}}}class E extends B{get config(){return super.config}openDetails(t){this.$vApp.$store.set("details/setPayload!",t),this.$iApi.panel.get("details-layers").isOpen||this.$iApi.panel.open({id:"details-layers"})}openFeature(t){this.$vApp.$store.set(y.payload,[]);const s=this.$iApi.panel.get("details-layers");s.isOpen&&this.$iApi.panel.close(s);let a=this.$iApi.panel.get("details-items"),r={result:{items:[{data:t.data,format:t.format,loaded:!0,loading:Promise.resolve()}],uid:t.uid,loading:Promise.resolve(),loaded:!0}};a.isOpen?a.show({screen:"item-screen",props:r}):this.$iApi.panel.open({id:"details-items",screen:"item-screen",props:r})}_parseConfig(t){t&&t.templates&&this.$vApp.$store.set(y.defaultTemplates,t.templates);let s=this.getLayerFixtureConfigs(),a=[];Object.keys(s).forEach(d=>{a.push({id:d,template:s[d].template})});const r=a.map(d=>new F(d));this.$vApp.$store.set(y.templates,r.reduce((d,m)=>(d[m.id]=m,d),{})),this._validateItems()}_validateItems(){Object.values(this.$vApp.$store.get(y.templates)).forEach(t=>{t.template in this.$vApp.$options.components&&this.$vApp.$store.set(`${y.templates}@${t.id}.componentId`,t.template)})}}const G=I({name:"DetailsLayersScreenV",props:{panel:N},data(){return{layerResults:[],lastLayerUid:"",activeGreedy:0,payload:f(y.payload),getLayerByUid:f("layer/getLayerByUid"),layers:f("layer/layers"),watchers:[]}},computed:{totalResultCount(){return this.layerResults.map(e=>e.items.length).reduce((e,t)=>e+t,0)}},created(){this.watchers.push(this.$watch("payload",e=>{this.loadPayloadItems(e)},{deep:!1,immediate:!0}))},mounted(){this.$iApi.event.on(C.DETAILS_CLOSED,()=>this.activeGreedy=0,"details_item_closed")},beforeUnmount(){this.watchers.forEach(e=>e()),this.$iApi.event.off("details_item_closed")},methods:{loadPayloadItems(e){e!==void 0&&(this.activeGreedy=e.length===0?0:e[0].requestTime,this.layerResults=e,this.calculateGrandTotal(e),this.autoOpen(e))},autoOpen(e){const t=this.$iApi.panel.get("details-items");if(this.lastLayerUid&&t.isOpen){const s=this.layerResults.findIndex(a=>a.uid===this.lastLayerUid);if(s!==-1){const a=this.layerResults[s];a.loading.then(()=>{a.requestTime===this.activeGreedy&&(a.items.length>0?(this.activeGreedy=0,this.openResult(s)):this.autoOpenAny(e))})}else this.closeResult(),this.autoOpenAny(e)}else this.autoOpenAny(e)},autoOpenAny(e){const t=e.map(a=>a.loading.then(()=>a.items.length>0?Promise.resolve(a):Promise.reject())),s=e[0].requestTime;Promise.any(t).then(a=>{if(a.requestTime!==this.activeGreedy)return;const r=this.layerResults.findIndex(d=>d.uid===a.uid);this.activeGreedy=0,r!==-1&&this.openResult(r)}).catch(()=>{s===this.activeGreedy&&(this.lastLayerUid="",this.activeGreedy=0,this.closeResult())})},calculateGrandTotal(e){Promise.all(e.map(t=>t.loading)).then(()=>{this.$iApi.updateAlert(this.$iApi.$vApp.$t("details.layers.found",{numResults:this.totalResultCount,numLayers:e.length}))})},closeResult(){const e=this.$iApi.panel.get("details-items");e.isOpen&&e.close()},openResult(e){if(this.payload[e].items.length>0){this.activeGreedy=0;let t=this.$iApi.panel.get("details-items"),s={result:this.payload[e]};this.lastLayerUid=this.payload[e].uid,t.isOpen?t.show({screen:"item-screen",props:s}):this.$iApi.panel.open({id:"details-items",screen:"item-screen",props:s})}},layerName(e){const t=this.payload[e];let s=this.getLayerByUid(t.uid);return s?s.name:""}}}),j={class:"p-5"},P=["onClick","disabled"],q=n("div",{class:"flex-auto"},null,-1),Z={key:0,class:"px-5"},Y={key:1,class:"animate-spin spinner h-20 w-20 px-5"};function J(e,t,s,a,r,d){const m=k("panel-screen"),c=w("truncate");return i(),L(m,{panel:e.panel},{header:$(()=>[g(u(e.$t("details.layers.title")),1)]),content:$(()=>[p(" Grond total "),n("div",j,u(e.$t("details.layers.found",{numResults:e.totalResultCount,numLayers:e.payload.length})),1),p(" Clicker for each layer "),(i(!0),l(D,null,T(e.layerResults,(o,h)=>(i(),l("button",{class:"w-full px-20 py-10 text-md flex hover:bg-gray-200 cursor-pointer disabled:cursor-default",key:o.uid,onClick:_=>o.loaded&&e.openResult(h),disabled:!(o.loaded&&o.items.length>0)},[v((i(),l("div",null,[g(u(e.layerName(h)||e.$t("details.layers.loading")),1)])),[[c]]),q,p(" Display the count if item exists, else display the loading spinner "),o.loaded?(i(),l("div",Z,u(o.items.length),1)):(i(),l("div",Y))],8,P))),128))]),_:1},8,["panel"])}var K=b(G,[["render",J],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/details/layers-screen.vue"]]);const W=I({name:"DetailsResultScreenV",props:{panel:{type:Object,required:!0},result:{type:Object,required:!0},previousItemIndex:{type:Number,default:-1}},data(){return{getLayerByUid:f("layer/getLayerByUid"),icon:[]}},computed:{nameField(){return this.getLayerByUid(this.result.uid)?.nameField},layerName(){return this.getLayerByUid(this.result.uid)?.name??""}},mounted(){this.$iApi.updateAlert(this.$iApi.$vApp.$t("details.item.alert.show.list",{layerName:this.layerName}))},methods:{openResult(e){this.panel.show({screen:"item-screen",props:{result:this.result,itemIndex:e}})},itemIcon(e,t){const s=this.getLayerByUid(this.result.uid);if(s===void 0){console.warn(`could not find layer for uid ${this.result.uid} during icon lookup`);return}const a=s.oidField;return s.getIcon(e[a]).then(r=>{this.icon[t]!==r&&(this.icon[t]=r)}),this.icon[t]}}}),X={key:0},Q={class:"flex font-bold p-8 w-full"},ee=["onClick","disabled"],te=["innerHTML"],se={key:1,class:"flex-initial py-5 px-10"},ie={key:2,class:"animate-spin spinner h-20 w-20 px-5"},ae={key:1};function le(e,t,s,a,r,d){const m=k("panel-screen"),c=w("truncate"),o=w("focus-item");return i(),L(m,{panel:e.panel},{header:$(()=>[g(u(e.$t("details.items.title")),1)]),content:$(()=>[e.result.items.length>0?(i(),l("div",X,[v((i(),l("span",Q,[g(u(e.layerName),1)])),[[c]]),(i(!0),l(D,null,T(e.result.items,(h,_)=>v((i(),l("button",{class:"w-full flex px-16 py-10 text-md hover:bg-gray-200 cursor-pointer",key:_,onClick:Pe=>h.loaded&&e.openResult(_),disabled:!h.loaded},[p(" ifs on each span as wrapper breaks aligment. smart person might improve things "),h.loaded?(i(),l("span",{key:0,innerHTML:e.itemIcon(h.data,_),class:"flex-none symbologyIcon"},null,8,te)):p("v-if",!0),h.loaded?v((i(),l("span",se,[g(u(h.data[e.nameField]||e.$t("details.result.default.name",[_+1])),1)])),[[c]]):p("v-if",!0),h.loaded?p("v-if",!0):(i(),l("span",ie))],8,ee)),[[o],[c]])),128))])):(i(),l("div",ae,u(e.$t("details.layers.results.empty")),1))]),_:1},8,["panel"])}var ne=b(W,[["render",le],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/details/result-screen.vue"]]);const re=I({name:"ESRIDefaultV",props:{fields:{type:Object,required:!0},identifyData:{type:Object,required:!0}},methods:{itemData(){const e={};Object.assign(e,this.identifyData.data),e.Symbol!==void 0&&delete e.Symbol;let t={};return this.fields.forEach(s=>{t[s.name]=s.alias||s.name}),Object.keys(e).map(s=>{e[s]={value:typeof e[s]=="number"?this.$iApi.$vApp.$n(e[s],"number"):e[s],alias:t[s]||s}}),e},makeHtmlLink(e){if(!e)return e;const t="underline text-blue-600 break-all",s=document.createElement("div");return s.innerHTML=e.trim(),s.firstElementChild?.tagName=="A"?(s.firstElementChild.className=t,s.innerHTML):z(e,{className:t,target:"_blank",validate:{url:r=>/^https?:\/\//.test(r)}})}}}),oe={class:"inline font-bold"},de=n("span",{class:"flex-auto"},null,-1),ue=["innerHTML"];function pe(e,t,s,a,r,d){return i(),l("div",null,[(i(!0),l(D,null,T(e.itemData(),(m,c,o)=>(i(),l("div",{class:"p-5 pl-3 flex justify-end flex-wrap even:bg-gray-300",key:o},[n("span",oe,u(m.alias),1),de,n("span",{class:"inline",innerHTML:e.makeHtmlLink(m.value)},null,8,ue)]))),128))])}var me=b(re,[["render",pe],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/details/templates/esri-default.vue"]]);const ce=I({name:"HTMLDefaultV",props:{identifyData:{type:Object,required:!0}}}),he=["innerHTML"],ye={key:1};function fe(e,t,s,a,r,d){return e.identifyData?(i(),l("div",{key:0,class:"whitespace-pre-wrap break-words h-full overflow-auto",innerHTML:e.identifyData.data},null,8,he)):(i(),l("div",ye,u(e.$t("details.layers.results.empty")),1))}var ve=b(ce,[["render",fe],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/details/templates/html-default.vue"]]);const ge=I({name:"DetailsItemScreenV",props:{panel:{type:Object,required:!0},result:{type:Object,required:!0},itemIndex:{type:Number,default:0}},components:{"esri-default":me,"html-default":ve},data(){return{defaultTemplates:f(y.defaultTemplates),templateBindings:f(y.templates),getLayerByUid:f("layer/getLayerByUid"),identifyTypes:R.UNKNOWN,icon:"",currentIdx:0}},mounted(){this.initDetails()},beforeUpdate(){this.initDetails()},computed:{identifyItem(){return this.result.items[this.currentIdx]},itemName(){const t=this.getLayerByUid(this.result.uid)?.nameField;return t&&this.identifyItem.loaded?this.identifyItem.data[t]:this.$t("details.items.title")},layerType(){return this.getLayerByUid(this.result.uid)?.layerType||""},supportsFeatures(){return this.getLayerByUid(this.result.uid)?.supportsFeatures??!1},fieldsList(){return this.supportsFeatures?this.getLayerByUid(this.result.uid)?.fields||[]:[]},detailsTemplate(){const e=this.getLayerByUid(this.result.uid);return e&&this.templateBindings[e.id]&&this.templateBindings[e.id].template?this.templateBindings[e.id].template:this.defaultTemplates&&this.defaultTemplates[this.identifyItem.format]?this.defaultTemplates[this.identifyItem.format]:this.supportsFeatures?"esri-default":"html-default"}},methods:{close(){this.panel.close(),this.$iApi.event.emit(C.DETAILS_CLOSED)},initDetails(){this.currentIdx=this.itemIndex??0,this.itemChanged()},itemChanged(){if(this.identifyItem.loaded)this.fetchIcon(),this.$iApi.updateAlert(`${this.$iApi.$vApp.$t("details.item.alert.show.item",{itemName:this.itemName})} ${this.result.items.length>1?this.$iApi.$vApp.$t("details.item.count",[this.currentIdx+1,this.result.items.length]):""}`);else{const e=this.currentIdx;this.identifyItem.loading.then(()=>{e===this.currentIdx&&this.itemChanged()})}},seeList(){this.panel.show({screen:"results-screen",props:{result:this.result,previousItemIndex:this.currentIdx}})},advanceItemIndex(e){this.currentIdx+=e,this.itemChanged()},fetchIcon(){if(this.icon="",!(this.identifyItem&&this.identifyItem.loaded))return;const e=this.getLayerByUid(this.result.uid);if(e===void 0){console.warn(`could not find layer for uid ${this.result.uid} during icon lookup`);return}if(e.supportsFeatures){const t=e.oidField;let s=this.currentIdx;e.getIcon(this.identifyItem.data[t]).then(a=>{this.currentIdx===s&&(this.icon=a)})}},zoomToFeature(){const e=this.getLayerByUid(this.result.uid);if(e===void 0){console.warn(`Could not find layer for uid ${this.result.uid} during zoom geometry lookup`);return}if(!this.identifyItem.loaded){console.warn("Details zoomToFeature call on item that is still loading. Should be impossible, alert the devs.");return}const t=this.identifyItem.data[e.oidField],s={getGeom:!0};e.getGraphic(t,s).then(a=>{a.geometry.invalid()?console.error(`Could not find graphic for objectid ${t}`):this.$iApi.geo.map.zoomMapTo(a.geometry,5e4)}),this.$iApi.updateAlert(this.$iApi.$vApp.$t("details.item.alert.zoom"))}}}),$e={key:0},_e={key:0,class:"flex justify-between py-8 px-8 mb-8 bg-gray-100"},Ie=["aria-label"],be={class:"flex bg-gray-200 py-8 items-center"},we=["content","aria-label","disabled"],Le=n("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[n("g",null,[n("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1),Ae=[Le],ke={class:"px-8"},Te=["content","aria-label","disabled"],De=n("svg",{height:"24",width:"24",viewBox:"0 0 23 23"},[n("g",null,[n("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})])],-1),Ce=[De],xe={key:1},Be={key:0,class:"flex py-8"},Ne=["innerHTML"],Re={key:1,class:"m-auto"},Oe=n("div",{class:"animate-spin spinner h-20 w-20"},null,-1),ze=[Oe],Fe={class:"flex-grow my-auto text-lg px-8"},Se=["content","aria-label"],Me=n("svg",{xmlns:"http://www.w3.org/2000/svg",height:"20",viewBox:"0 0 24 24",width:"20"},[n("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),n("path",{d:"M0 0h24v24H0V0z",fill:"none"}),n("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"})],-1),Ue=[Me],He={key:2,class:"animate-spin spinner h-20 w-20 px-5"},Ve={key:1,class:"animate-spin spinner h-20 w-20 px-5"};function Ee(e,t,s,a,r,d){const m=k("panel-screen"),c=w("tippy");return i(),L(m,{panel:e.panel},{header:$(()=>[g(u(e.$t("details.items.title")),1)]),content:$(()=>[e.result.loaded?(i(),l("div",$e,[p(" paginator and list button for multiple features "),e.result.items.length>1?(i(),l("div",_e,[n("button",{class:"px-8 font-bold hover:bg-gray-200 focus:bg-gray-200","aria-label":e.$t("details.item.see.list"),onClick:t[0]||(t[0]=(...o)=>e.seeList&&e.seeList(...o))},u(e.$t("details.item.see.list")),9,Ie),n("div",be,[v((i(),l("button",{content:e.$t("details.item.previous.item"),onClick:t[1]||(t[1]=o=>e.advanceItemIndex(-1)),class:"mx-2 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":e.$t("details.item.previous.item"),disabled:e.currentIdx===0},Ae,8,we)),[[c,{placement:"top"}]]),n("span",ke,u(e.$t("details.item.count",[e.currentIdx+1,e.result.items.length])),1),v((i(),l("button",{content:e.$t("details.item.next.item"),onClick:t[2]||(t[2]=o=>e.advanceItemIndex(1)),class:"mx-2 rotate-180 opacity-60 hover:opacity-90 disabled:opacity-30 disabled:cursor-default","aria-label":e.$t("details.item.next.item"),disabled:e.currentIdx===e.result.items.length-1},Ce,8,Te)),[[c,{placement:"top"}]])])])):p("v-if",!0),p(" actual details section "),e.identifyItem.loaded?(i(),l("div",xe,[p(" fancy header for esri features "),e.supportsFeatures?(i(),l("div",Be,[e.icon?(i(),l("span",{key:0,class:"flex-none m-auto symbologyIcon",innerHTML:e.icon},null,8,Ne)):(i(),l("div",Re,ze)),n("span",Fe,u(e.itemName),1),v((i(),l("button",{content:e.$t("details.item.zoom"),"aria-label":e.$t("details.item.zoom"),onClick:t[3]||(t[3]=o=>e.zoomToFeature()),class:"text-gray-600 m-8"},Ue,8,Se)),[[c,{placement:"bottom"}]])])):p("v-if",!0),(i(),L(O(e.detailsTemplate),{identifyData:e.identifyItem,fields:e.fieldsList},null,8,["identifyData","fields"]))])):(i(),l("div",He))])):(i(),l("div",Ve))]),_:1},8,["panel"])}var Ge=b(ge,[["render",Ee],["__file","/home/runner/work/ramp4-pcar4/ramp4-pcar4/src/fixtures/details/item-screen.vue"]]),je={en:{"details.layers.title":"Identified Layers","details.layers.found":"Found {numResults} results in {numLayers} layers","details.layers.loading":"The layer is loading...","details.layers.results.empty":"No results found for the selected layer.","details.result.default.name":"Identify Item {0}","details.items.title":"Details","details.item.see.list":"See List","details.item.zoom":"Zoom to feature","details.item.previous.item":"Previous item","details.item.next.item":"Next item","details.item.count":"{0} of {1}","details.item.alert.zoom":"Zoomed into feature","details.item.alert.show.item":"Showing result {itemName}","details.item.alert.show.list":"Showing all results for {layerName}"},fr:{"details.layers.title":"[fr] Couches Identifi\xE9s","details.layers.found":"{numResults} r\xE9sultats trouv\xE9s dans {numLayers} couches","details.layers.loading":"La couche est en cours de chargement...","details.layers.results.empty":"Aucun r\xE9sultat trouv\xE9 pour la couche s\xE9lectionn\xE9e.","details.result.default.name":"[fr] D\xE9terminer le point {0}","details.items.title":"D\xE9tails","details.item.see.list":"[fr] Voir la liste","details.item.zoom":"Zoom \xE0 l'\xE9l\xE9ment","details.item.previous.item":"[fr] Point pr\xE9c\xE9dent","details.item.next.item":"[fr] Prochain article","details.item.count":"[fr] {0} de {1}","details.item.alert.zoom":"[fr] Zoomed into feature","details.item.alert.show.item":"[fr] Showing result {itemName}","details.item.alert.show.list":"[fr] Showing all results for {layerName}"}};class Ye extends E{async added(){this.$iApi.panel.register({"details-layers":{screens:{"layers-screen":A(K)},style:{width:"350px"},button:{tooltip:"details.layers.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'},alertName:"details.layers.title"},"details-items":{screens:{"results-screen":A(ne),"item-screen":A(Ge)},style:{width:"350px"},button:{tooltip:"details.items.title",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none" /><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" /></svg>'},alertName:"details.items.title"}},{i18n:{messages:je}}),this.$vApp.$store.registerModule("details",V()),this._parseConfig(this.config);let t=this.$vApp.$watch(()=>this.config,s=>this._parseConfig(s));this.removed=()=>{console.log(`[fixture] ${this.id} removed`),t(),this.$iApi.panel.remove("details-items"),this.$iApi.panel.remove("details-layers"),this.$vApp.$store.unregisterModule("details")}}}export{Ye as default};
